
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Tafels oefenen</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">Tafels oefenen</h3>
              <ul class="nav masthead-nav">
                <li class="mode-1 active"><a href="#"><span class="glyphicon glyphicon-random"></span></a></li>
                <li class="mode-2"><a href="#">2</a></li>
                <li class="mode-3"><a href="#">3</a></li>
                <li class="mode-4"><a href="#">4</a></li>
                <li class="mode-5"><a href="#">5</a></li>
                <li class="mode-6"><a href="#">6</a></li>
                <li class="mode-7"><a href="#">7</a></li>
                <li class="mode-8"><a href="#">8</a></li>
                <li class="mode-9"><a href="#">9</a></li>
                <li class="mode-10"><a href="#">10</a></li>
              </ul>
            </div>
          </div>

          <div class="inner cover">
            <!-- #loading -->
            <div id="loading">
              <p>Bezig met laden...</p>
            </div>
            <!-- /#loading -->
            <!-- #intro -->
            <div id="intro"><p class="lead">Hoi! Tafels oefenen is niet altijd zo leuk, maar je leert er wel snel mee rekenen. Daarom krijg je na elke vijf juiste oplossingen hier een grappig filmpje te zien. Je kiest zelf welke tafels je wil oefenen, bovenaan de pagina. Opgelet! Telkens je daar een nieuwe tafel kiest, begint de teller weer van voren.</p>
            <button type="button" class="btn btn-lg btn-primary startbtn" >Start!</button>
            </div>
            <!-- /#intro -->
            <!-- #success -->
            <div id="outro-success"><p class="lead">Joechei! 't Is gedaan!</p>
            <button type="button" class="btn btn-lg btn-primary startbtn" >Opnieuw!</button>
            </div>
            <!-- /#success -->
            <!-- #fail -->
            <div id="outro-fail"><p class="lead">Oeps, dat duurde iets te lang!</p>
            <button type="button" class="btn btn-lg btn-primary startbtn" >Opnieuw!</button>
            </div>
            <!-- /#fail -->
            <!-- #gif -->
            <div id="intermission">
              <div id="gifholder">
                <img class="funnygif" src="funnygifs/cat1.gif" height="50%">
              </div>
              <button type="button" class="btn btn-lg btn-primary contbtn" >Verder</button>
            </div>
            <!-- /#gif -->
            <!-- # excercise -->
            <div id="excercise"><h1 class="cover-heading"><span id="firstpart"></span> x <span id="secondpart"></span> <span id="feedback"></span></h1>
            <table class="table table-bordered" id="honderdveld">
              <tr>
                <td>Bezig met laden...</td>
              </tr>
            </table>
            <button type="button" class="btn btn-lg btn-primary" id="nextbtn">Volgende</button>
          </div>
          <!-- /#excercise -->
          </div>

          <div class="mastfoot" id="progress">

            <div class="inner">
              <p><span id="currentex">1</span> van <span id="totalex">10</span></p>
              <div class="progress">
                <div id="countdownbar" class="progress-bar progress-bar-success" role="progressbar" style="width: 100%">
                  <span class="sr-only">Countdown timer</span>
                </div>
              </div>
            </div>
          </div>

        </div>

      </div>

    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script>
    $( document ).ready(function() {
        $("#loading").hide();
        $("#intro").show();
        // begin initial data
        var multitables = [2,3,4,5,6,7,8,9,10];
        var multipliers = [1,2,3,4,5,6,7,8,9,10];
        var excounter = 0;
        var tablemode =1;
        var timetocount = 0;
        var timeleft = 0
        var timeperq = 4;
        var penalty = 2;
        var bonus = 1;
        var funnygifs = new Array(
          "cat1.gif",
          "cat2.gif",
          "cat3.gif",
          "cat4.gif",
          "cat5.gif",
          "cat6.gif",
          "cat7.gif",
          "cat8.gif",
          "minions1.gif",
          "minions2.gif",
          "robot1.gif"
        );
        // end initial data
        // begin mode selector
        for (m=1,mlen=10; m<=mlen;m++) {
          $("li.mode-"+m+" a").data( "mode", m );
          $("li.mode-"+m+" a").click(function(){
            $(".masthead-nav li").removeClass("active");
            $(this).parent().addClass("active"); 
            tablemode = $(this).data("mode");
            startRun($(this).data("mode"));
            //console.log($(this).data("mode"));
          });
        }
        // end mode selector
        function startRun(tablemode) {   
          clearInterval(window.countdowninterval);
          excounter = 0;
          timetocount = 0;
          //console.log("tablemode: "+tablemode);       
          $("#intro").hide(); 
          $("#intermission").hide();
          $("#outro-fail").hide();
          $("#outro-success").hide();
          $("#excercise").show();
          $("#progress").show();
          goTables(tablemode);
        }
        function drawField() {
          var fieldhtml ="";
          for(var row = 0, rlen = 10; row< rlen; row++) {
            fieldhtml+="<tr>";
            for(var cell = 1, clen = 10; cell<= clen; cell++) {
              var cellval=(row*10)+cell;
              fieldhtml+="<td class='clickcell' id='cell"+cellval+"'><a class='celllink' data-value='"+cellval+"' href='?firstpart="+window.qtoshow[0].firstpart+"&secondpart="+window.qtoshow[0].secondpart+"&answer="+cellval+"'>"+cellval+"</a></td>";
            }  
            fieldhtml+="</tr>";
          }  
          $("#honderdveld").html(fieldhtml);
          $(".celllink").click(function(event){
            event.preventDefault();
            $(".celllink").removeClass("hilite");
            $(this).addClass("hilite");
            var answerclicked = parseInt($(this).attr("data-value"));
            checkAnswer(answerclicked);
            //console.log($(this).attr("data-value"));
          });
          //console.log(fieldhtml);
        }
        function goTables(limit) {
            if (multitables.indexOf(limit) > -1) {
              var mytables = [limit];
              //console.log("not all tables");
              //console.table(mytables);
            } else {
              var mytables = multitables;
              //console.log("all tables");
            }
            window.questions = [];
            window.clonedgifs = funnygifs.slice(0);
            //var qcounter = 0;
            for(var i = 0, len = mytables.length; i< len; i++) {
              var firstpart = mytables[i];
              for(var j = 0, jlen = multipliers.length; j< jlen; j++) {
                var secondpart = multipliers[j];
                var solution = firstpart*secondpart;
                var thisquestion = Object.create(null);
                thisquestion.firstpart = firstpart;
                thisquestion.secondpart = secondpart;
                thisquestion.solution = solution;
                window.questions.push(thisquestion);
              }
            }           
            $("#totalex").html(window.questions.length);
            timetocount=window.questions.length*timeperq;
            timeleft = timetocount;
            updateBar();
            window.countdowninterval = setInterval(trackTime,1000);
            getQuestion();
        }
        function continueRun() {          
            $("#intermission").hide();
            $("#excercise").show();
            $("#progress").show();
            window.countdowninterval = setInterval(trackTime,1000);            
        }
        function trackTime() {
              timeleft--
              updateBar();
              console.log("timeleft: "+timeleft+" / "+window.countdowninterval);
        }
        function updateBar() {
            if (timeleft<0) {
                timeleft=0;
                if (window.questions.length>0) {
                  $("#excercise").hide();
                  $("#outro-fail").show();
                }
            }
            relval=(timeleft/timetocount)*100;
            console.log(relval);
            $("#countdownbar").css("width",relval+"%");
        }
        function showIntermission(){                  
              clearInterval(window.countdowninterval);
              if (window.clonedgifs.length===0) {
                window.clonedgifs = funnygifs.slice(0);
              } 
              fg=Math.floor(Math.random()*(window.clonedgifs.length));
              window.currentgif = window.clonedgifs.splice(fg, 1);
              $("#progress").hide();
              $("#excercise").hide();
              $("#intermission").show();
              $("#gifholder").html('<img class="funnygif" src="funnygifs/'+window.currentgif+'" width="80%">');
              console.table(window.currentgif);
              if (window.questions.length===0) {
                $(".contbtn").click(function(){
                   $("#excercise").hide();
                   $("#outro-success").show();
                });
              } else {
                $(".contbtn").click(function(){
                   continueRun();
                });
              }
        }
        function getQuestion(q) {
          if (window.questions.length===0) {
            $("#excercise").hide();
            $("#outro-success").show();
          } else {      
            if (excounter%5===0&&excounter>4) {          
              showIntermission();
            }      
            excounter++;
            $("#currentex").html(excounter);
            console.log("excounter: "+excounter);
            if (q===undefined || q < 0) {           
              if (window.questions.length===1) {
                q=0;
              } else {
                q=Math.floor(Math.random()*(window.questions.length));
              }
            }
            //console.log("get question: "+q);
            window.qtoshow = window.questions.splice(q, 1);
            //console.log(qtoshow[0]);
            //console.log(qtoshow[0].firstpart);
            $("#firstpart").html(window.qtoshow[0].firstpart);
            $("#secondpart").html(window.qtoshow[0].secondpart);
            $("#feedback").html("<span class='glyphicon glyphicon-question-sign'></span>");
            drawField();
            $('#nextbtn').prop('disabled', true);
            //console.table(qtoshow);
          }
        }
        function checkAnswer(answer){
          //console.log(answer+" / "+window.qtoshow[0].solution);
          if (answer===window.qtoshow[0].solution) {
            //timeleft+=bonus;
            //updateBar();
            $("#feedback").html("<span class='glyphicon glyphicon-ok-circle'></span>");
            $('#nextbtn').prop('disabled', false);
          } else {
            //timeleft-=penalty;
            //updateBar();
            $("#feedback").html("<span class='glyphicon glyphicon-remove-circle'></span>");  
            $('#nextbtn').prop('disabled', true);          
          }
        }
        //initial button activate
        $(".startbtn").click(function(){
          startRun(tablemode);
        });
        $(".contbtn").click(function(){
          continueRun();
        });
        // next button action
        $('#nextbtn').click(function(){
          getQuestion();
          console.log(window.questions.length);
        });
    });
    </script>
  </body>
</html>
